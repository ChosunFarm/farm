<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Admin - Member Management</title>
  <!-- Add your CSS references here -->
</head>
<body>
<header>
  <!-- Navigation bar -->
  <div th:if="${isLogin}">
    <span th:text="'Welcome, ' + ${username}"></span>
    <a href="/logout">Logout</a>
  </div>
  <div th:unless="${isLogin}">
    <a href="/login">Login</a>
  </div>
</header>

<main>
  <h1>Member Management</h1>

  <!-- Search Form -->
  <form th:action="@{/admin/members}" method="get">
    <input type="text" name="search" th:value="${search}" placeholder="Search by username or email">

    <select name="memberType">
      <option value="">All Member Types</option>
      <option value="ADMIN" th:selected="${memberType == 'ADMIN'}">Admin</option>
      <option value="USER" th:selected="${memberType == 'USER'}">User</option>
      <option value="SELLER" th:selected="${memberType == 'SELLER'}">Seller</option>
    </select>

    <button type="submit">Search</button>
  </form>

  <!-- Members Table -->
  <table>
    <thead>
    <tr>
      <th>ID</th>
      <th>Username</th>
      <th>Email</th>
      <th>Type</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="member : ${members}">
      <td th:text="${member.id}"></td>
      <td th:text="${member.username}"></td>
      <td th:text="${member.email}"></td>
      <td th:text="${member.user_type}"></td>
      <td>
        <form th:action="@{/admin/member/update-role}" method="post">
          <input type="hidden" name="memberId" th:value="${member.id}">
          <select name="role">
            <option value="ADMIN" th:selected="${member.user_type == 'ADMIN'}">Admin</option>
            <option value="USER" th:selected="${member.user_type == 'USER'}">User</option>
            <option value="SELLER" th:selected="${member.user_type == 'SELLER'}">Seller</option>
          </select>
          <button type="submit">Update Role</button>
        </form>
      </td>
    </tr>
    <tr th:if="${members.empty}">
      <td colspan="5">No members found</td>
    </tr>
    </tbody>
  </table>

  <!-- Pagination -->
  <div th:if="${totalPages > 1}">
    <ul class="pagination">
      <!-- First and Previous buttons -->
      <li th:class="${currentPage == 1} ? 'disabled' : ''">
        <a th:if="${currentPage > 1}" th:href="@{/admin/members(page=1, search=${search}, memberType=${memberType}, status=${status})}">First</a>
        <span th:unless="${currentPage > 1}">First</span>
      </li>
      <li th:class="${currentPage == 1} ? 'disabled' : ''">
        <a th:if="${currentPage > 1}" th:href="@{/admin/members(page=${currentPage - 1}, search=${search}, memberType=${memberType}, status=${status})}">Previous</a>
        <span th:unless="${currentPage > 1}">Previous</span>
      </li>

      <!-- Page numbers -->
      <li th:each="pageNum : ${#numbers.sequence(startPage, endPage)}" th:class="${pageNum == currentPage} ? 'active' : ''">
        <a th:href="@{/admin/members(page=${pageNum}, search=${search}, memberType=${memberType}, status=${status})}" th:text="${pageNum}"></a>
      </li>

      <!-- Next and Last buttons -->
      <li th:class="${currentPage == totalPages} ? 'disabled' : ''">
        <a th:if="${currentPage < totalPages}" th:href="@{/admin/members(page=${currentPage + 1}, search=${search}, memberType=${memberType}, status=${status})}">Next</a>
        <span th:unless="${currentPage < totalPages}">Next</span>
      </li>
      <li th:class="${currentPage == totalPages} ? 'disabled' : ''">
        <a th:if="${currentPage < totalPages}" th:href="@{/admin/members(page=${totalPages}, search=${search}, memberType=${memberType}, status=${status})}">Last</a>
        <span th:unless="${currentPage < totalPages}">Last</span>
      </li>
    </ul>
  </div>
</main>

<footer>
  <!-- Footer content -->
</footer>
</body>
</html>